#!/usr/bin/env bash

main () {
    dark=0
    alt=0
    reset=0
    help=0

    for i ; do
        if [[ "$i" == "dark" ]] ; then
            dark=1
        elif [[ "$i" == "light" ]] || [[ "$i" == "nodark" ]] ; then
            dark=0
        fi
        if [[ "$i" == "alt" ]] ; then
            alt=1
        elif [[ "$i" == "noalt" ]] ; then
            alt=0
        fi
        if [[ "$i" == "reset" ]] ; then
            reset=1
        elif [[ "$i" == "noreset" ]] ; then
            reset=0
        fi
        if [[ "$i" == "help" ]] ; then
            help=1
        elif [[ "$i" == "nohelp" ]] ; then
            help=0
        fi
    done

    define_colors

    if (( help )) ; then
        cat <<EOF
solarterm
solarterm dark
solarterm alt
solarterm alt dark
solarterm reset
solarterm help
EOF
    elif (( reset )) ; then
        reset_theme
    else
        if (( alt )) ; then
            set_alt_colors
            if (( dark )) ; then
                set_alt_colors--dark
            fi
        else
            set_alt_colors
            if (( dark )) ; then
                set_alt_colors--dark
            fi
        fi
        set_solarized_colors
        set_theme
    fi

}

set_theme () {
    echo "setting theme" >&2

    # Change Dynamic Colors
    echo -n $'\e]10;'"${fg}"$'\e\\'
    echo -n $'\e]11;'"${bg}"$'\e\\'
    echo -n $'\e]12;'"${cursor}"$'\e\\'
    echo -n $'\e]13;'"${pointerfg}"$'\e\\'
    echo -n $'\e]14;'"${pointerbg}"$'\e\\'
    echo -n $'\e]17;'"${hibg}"$'\e\\'
    echo -n $'\e]19;'"${hifg}"$'\e\\'

    # Change Colour Number 0 - 15
    echo -n $'\e]4;'"0;${color0}"$'\e\\'
    echo -n $'\e]4;'"1;${color1}"$'\e\\'
    echo -n $'\e]4;'"2;${color2}"$'\e\\'
    echo -n $'\e]4;'"3;${color3}"$'\e\\'
    echo -n $'\e]4;'"4;${color4}"$'\e\\'
    echo -n $'\e]4;'"5;${color5}"$'\e\\'
    echo -n $'\e]4;'"6;${color6}"$'\e\\'
    echo -n $'\e]4;'"7;${color7}"$'\e\\'
    echo -n $'\e]4;'"8;${color8}"$'\e\\'
    echo -n $'\e]4;'"9;${color9}"$'\e\\'
    echo -n $'\e]4;'"10;${color10}"$'\e\\'
    echo -n $'\e]4;'"11;${color11}"$'\e\\'
    echo -n $'\e]4;'"12;${color12}"$'\e\\'
    echo -n $'\e]4;'"13;${color13}"$'\e\\'
    echo -n $'\e]4;'"14;${color14}"$'\e\\'
    echo -n $'\e]4;'"15;${color15}"$'\e\\'
}

reset_theme () {
    echo -n $'\e]104;0\e\\'
    echo -n $'\e]104;1\e\\'
    echo -n $'\e]104;2\e\\'
    echo -n $'\e]104;3\e\\'
    echo -n $'\e]104;4\e\\'
    echo -n $'\e]104;5\e\\'
    echo -n $'\e]104;6\e\\'
    echo -n $'\e]104;7\e\\'
    echo -n $'\e]104;8\e\\'
    echo -n $'\e]104;9\e\\'
    echo -n $'\e]104;10\e\\'
    echo -n $'\e]104;11\e\\'
    echo -n $'\e]104;12\e\\'
    echo -n $'\e]104;13\e\\'
    echo -n $'\e]104;14\e\\'
    echo -n $'\e]104;15\e\\'
    #                 /\ mintty doesn't take a semicolon here.

    echo -n $'\e]110;\e\\'
    echo -n $'\e]111;\e\\'
    echo -n $'\e]112;\e\\'
    echo -n $'\e]113;\e\\'
    echo -n $'\e]114;\e\\'
    echo -n $'\e]115;\e\\'
    echo -n $'\e]116;\e\\'
    echo -n $'\e]117;\e\\'
    echo -n $'\e]118;\e\\'
    echo -n $'\e]119;\e\\'
    #               ^-- why, mintty?
}

set_base_colors () {
    base03="${default_base03}"
    base02="${default_base02}"
    base01="${default_base01}"
    base00="${default_base00}"
    base0="${default_base0}"
    base1="${default_base1}"
    base2="${default_base2}"
    base3="${default_base3}"
    yellow="${default_yellow}"
    orange="${default_orange}"
    red="${default_red}"
    magenta="${default_magenta}"
    violet="${default_violet}"
    blue="${default_blue}"
    cyan="${default_cyan}"
    green="${default_green}"
}

set_base_colors--dark () {
    base03="${default_base3}"
    base02="${default_base2}"
    base01="${default_base1}"
    base00="${default_base0}"
    base0="${default_base00}"
    base1="${default_base01}"
    base2="${default_base02}"
    base3="${default_base03}"
}

set_alt_colors () {
    base03="${alt_base03}"
    base02="${alt_base02}"
    base01="${alt_base01}"
    base00="${alt_base00}"
    base0="${alt_base0}"
    base1="${alt_base1}"
    base2="${alt_base2}"
    base3="${alt_base3}"
    yellow="${alt_yellow}"
    orange="${alt_orange}"
    red="${alt_red}"
    magenta="${alt_magenta}"
    violet="${alt_violet}"
    blue="${alt_blue}"
    cyan="${alt_cyan}"
    green="${alt_green}"
}

set_alt_colors--dark () {
    base03="${alt_base3}"
    base02="${alt_base2}"
    base01="${alt_base1}"
    base00="${alt_base0}"
    base0="${alt_base00}"
    base1="${alt_base01}"
    base2="${alt_base02}"
    base3="${alt_base03}"
}

define_colors () {
    default_base03=\#002b36;  alt_base03=\#1c1c1c # Colour2, Colour4, Colour7
    default_base02=\#073642;  alt_base02=\#262626 # Colour3, Colour6
    default_base01=\#586e75;  alt_base01=\#585858 # Colour11
    default_base00=\#657b83;  alt_base00=\#626262 # Colour13
    default_base0=\#839496;   alt_base0=\#808080 # Colour0, Colour15
    default_base1=\#93a1a1;   alt_base1=\#8a8a8a # Colour1, Colour19
    default_base2=\#eee8d5;   alt_base2=\#e4e4e4 # Colour5, Colour20
    default_base3=\#fdf6e3;   alt_base3=\#ffffd7 # Colour21
    default_yellow=\#b58900;  alt_yellow=\#af8700 # Colour12
    default_orange=\#cb4b16;  alt_orange=\#d75f00 # Colour9
    default_red=\#dc322f;     alt_red=\#d70000 # Colour8
    default_magenta=\#d33682; alt_magenta=\#af005f # Colour16
    default_violet=\#6c71c4;  alt_violet=\#5f5faf  # Colour17
    default_blue=\#268bd2;    alt_blue=\#0087ff # Colour14
    default_cyan=\#2aa198;    alt_cyan=\#00afaf # Colour18
    default_green=\#859900;   alt_green=\#5f8700 # Colour10
}

set_solarized_colors () {
    color0="${base02}"
    color1="${red}"
    color2="${green}"
    color3="${yellow}"
    color4="${blue}"
    color5="${magenta}"
    color6="${cyan}"
    color7="${base2}"
    color8="${base03}"
    color9="${orange}"
    color10="${base01}"
    color11="${base00}"
    color12="${base0}"
    color13="${violet}"
    color14="${base1}"
    color15="${base3}"
    cursor="${base01}"
    fg="${base03}"
    bg="${base3}"
    pointerfg="${fg}"
    pointerbg="${bg}"
    hibg="${base2}"
    hifg="${base02}"
}

main "$@"
